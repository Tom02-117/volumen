<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inicio de Sesión - Volumen de Hierro</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="estilos.css" />
</head>
<body class="login-page">

  <div class="login-box row">
    
    <div class="col-md-6 d-flex flex-column align-items-center justify-content-center p-4 bg-light">
      <img src="https://e00-telva.uecdn.es/assets/multimedia/imagenes/2024/02/06/17072138183011.jpg" 
           alt="Imagen Gym"     
           class="img-fluid rounded mb-3" 
           style="max-width: 400px; border-radius: 15px;" />
      <div class="text-center">
        <p class="mb-1">¿No tienes una cuenta?</p>
        <a href="crearcuenta.html" class="btn btn-outline-warning btn-sm">Regístrate</a>
        <div class="mt-3">
          <a href="index.html" class="text-decoration-none d-block">Volver al sitio</a>
          <a href="#" class="text-decoration-none d-block">Política de privacidad</a>
        </div>
      </div>
    </div>

    <div class="col-md-6 d-flex align-items-center">
      <div class="login-form w-100">
        <div class="text-center mb-4">
          <img src="../img/logo.png" alt="Logo" width="120" />
          <h3 class="mt-3">Iniciar Sesión</h3>
        </div>

        <form action="../backend/auth/iniciar_sesion.php" method="POST">
          <!-- CAMPOS OCULTOS PARA GUARDAR LOS DATOS DE LA CLASE -->
          <input type="hidden" id="redirect" name="redirect">
          <input type="hidden" id="clase" name="clase">
          <input type="hidden" id="dia" name="dia">
          <input type="hidden" id="hora" name="hora">

          <div class="mb-3">
              <label for="tipo_documento" class="form-label">Tipo de Documento</label>
              <select class="form-select" id="tipo_documento" name="tipo_documento" required>
                <option value="" selected disabled>Seleccione...</option>
                <option value="CC">Cédula de Ciudadanía</option>
                <option value="TI">Tarjeta de Identidad</option>
                <option value="CE">Cédula de Extranjería</option>
                <option value="PA">Pasaporte</option>
              </select>
          </div>

          <div class="mb-3">
            <label for="numero_documento" class="form-label">Número de Documento</label>
            <input type="text" class="form-control" id="numero_documento" name="numero_documento" required>
          </div>

          <div class="mb-3 position-relative">
              <label for="password" class="form-label">Contraseña</label>
              <input type="password" id="password" name="password" class="form-control" required>
              <i class="bi bi-eye-slash position-absolute" id="togglePassword" style="right: 15px; top: 70%; transform: translateY(-50%); cursor: pointer;"></i>
          </div>
          <br>
          <button type="submit" class="btn btn-primary w-100">Iniciar Sesión</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Librerías JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Script de la página (unificado y corregido) -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        const params = new URLSearchParams(window.location.search);
        
        // --- 1. LÓGICA PARA RECORDAR LA CLASE QUE SE QUIERE COMPRAR ---
        if (params.get('redirect') === 'pagar_clase') {
            document.getElementById('redirect').value = params.get('redirect');
            document.getElementById('clase').value = params.get('clase');
            document.getElementById('dia').value = params.get('dia');
            document.getElementById('hora').value = params.get('hora');
            
            const infoBox = document.createElement('div');
            infoBox.innerHTML = `Inicia sesión para finalizar la compra de tu clase de <b>${params.get('clase')}</b>.`;
            infoBox.className = 'alert alert-info';
            
            const form = document.querySelector('form');
            form.parentNode.insertBefore(infoBox, form);
        }

        // --- 2. LÓGICA PARA MOSTRAR ALERTAS ---
        if (params.get("error") === "credenciales_invalidas") {
            Swal.fire({
                icon: "error",
                title: "Error de inicio de sesión",
                text: "Usuario o contraseña incorrectos. Intenta de nuevo.",
                confirmButtonColor: "#dc3545"
            });
        }
        
        if (params.get("status") === "registro_exitoso") {
            Swal.fire({
                icon: "success",
                title: "¡Registro Exitoso!",
                text: "Tu cuenta ha sido creada. Ahora puedes iniciar sesión.",
                confirmButtonColor: "#28a745"
            });
        }

        // --- 3. LÓGICA PARA EL BOTÓN DE VER/OCULTAR CONTRASEÑA ---
        const passwordInput = document.getElementById('password');
        const togglePassword = document.getElementById('togglePassword');

        if (passwordInput && togglePassword) {
            togglePassword.addEventListener('mousedown', function () {
                passwordInput.type = 'text';
                this.classList.remove('bi-eye-slash');
                this.classList.add('bi-eye');
            });

            togglePassword.addEventListener('mouseup', function () {
                passwordInput.type = 'password';
                this.classList.remove('bi-eye');
                this.classList.add('bi-eye-slash');
            });

            togglePassword.addEventListener('mouseleave', function () {
                if (passwordInput.type === 'text') {
                    passwordInput.type = 'password';
                    this.classList.remove('bi-eye');
                    this.classList.add('bi-eye-slash');
                }
            });
        }
    });
</script>

</body>
</html>